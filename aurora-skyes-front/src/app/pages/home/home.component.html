<app-header/>

<div class="container">
  <div class="flight-search-form">
    <form [formGroup]="flightSearchForm" class="search-section">

      <div class="flex">
        <div class="form-group">
          <label for="trip-type">Type de trajet</label>
          <select formControlName="tripType" id="trip-type">
            <option value="aller-retour">Aller-retour</option>
          </select>
        </div>

        <div class="form-group">
          <label for="currency">Monnaie</label>
          <select formControlName="currencyRate" id="currency">
            <option disabled selected value="">Veuillez s√©lectionner une monnaie</option>
            @for (item of monnaieList; track item) {
              <option [value]="item.taux">{{ item.nom }}</option>
            }
          </select>
        </div>
      </div>

      <div class="form-group">
        <label for="class">D√©part de</label>
        <select formControlName="departure" id="departure">
          <option disabled selected value="">Veuillez s√©lectionner un a√©roport</option>
          @for (item of airportList; track item) {
            <option [value]="item.nom">{{ item.ville }}({{ item.nom }})</option>
          }
        </select>
      </div>

      <div class="form-group">
        <label for="arrival">Arriv√©e √†</label>
        <select formControlName="arrival" id="arrival">
          <option disabled selected value="">Veuillez s√©lectionner un a√©roport</option>
          @for (item of airportList; track item) {
            <option [value]="item.nom">{{ item.ville }}({{ item.nom }})</option>
          }
        </select></div>

      <div class="form-group">
        <label for="date">Dates de voyage</label>
        <div class="date-range" id="date">
          <input formControlName="departureDate" placeholder="D√©part" type="date"/>
          <input formControlName="returnDate" placeholder="Retour" type="date"/>
        </div>
      </div>

      <div class="form-group">
        <label for="passengers">Passagers</label>
        <input formControlName="passengers" id="passengers" min="1" type="number" value="1"/>
      </div>

      <div class="form-group">
        <label for="class">Classe</label>
        <select formControlName="class" id="class">
          <option value="economy">Economie</option>
          <option value="first">Premi√®re</option>
        </select>
      </div>


      <button (click)="onSearch()" [disabled]="flightSearchForm.invalid" class="search-button" type="button">Rechercher
        les vols
      </button>

      @if (error != '') {
        <p class="error">{{ error }}</p>
      }
    </form>
  </div>

  <div class="destination-list">
    @if (search) {
      <div class="flight-section">
        <h3>Vol aller</h3>
        @if (outboundFlights.length == 0) {
          <p>Pas de vol all√© trouv√© pour votre recherche</p>
        }
        @for (flight of outboundFlights; track outboundFlights) {
          <div class="destination-item">
            <div class="destination-info">
              <p class="long-text">{{ flight.aeroportDepart.ville }}({{ flight.aeroportDepart.nom }})
                ‚û°Ô∏è {{ flight.aeroportArrivee.ville }}({{ flight.aeroportArrivee.nom }})</p>
              <p class="short-text">{{ flight.dateDepart | date:'HH:mm' }} üï∞Ô∏è {{ flight.dateArrive | date:'HH:mm' }}</p>
              <p class="tag">{{ flightSearchForm.controls.class.value == 'economy' ? 'Economie' : 'Business' }}</p>
              <p class="short-text">{{ flight.prix }}/personne</p>
              <button type="button" (click)="selectFlight(flight)">R√©server</button>
            </div>
          </div>
        }
      </div>
      <hr>
      <div class="flight-section">
        <h3>Vol retour</h3>
        @if (returnFlights.length == 0) {
          <p>Pas de vol retour trouv√© pour votre recherche</p>
        }
        @for (flight of returnFlights; track returnFlights) {
          <div class="destination-item">
            <div class="destination-info">
              <p class="long-text">{{ flight.aeroportDepart.ville }}({{ flight.aeroportDepart.nom }})
                ‚û°Ô∏è {{ flight.aeroportArrivee.ville }}({{ flight.aeroportArrivee.nom }})</p>
              <p class="short-text">{{ flight.dateDepart | date:'HH:mm' }} üï∞Ô∏è {{ flight.dateArrive | date:'HH:mm' }}</p>
              <p class="tag">{{ flightSearchForm.controls.class.value == 'economy' ? 'Economie' : 'Business' }}</p>
              <p class="short-text">{{ flight.prix }}/personne</p>
              <button type="button" (click)="selectFlight(flight)">R√©server</button>
            </div>
          </div>
        }
      </div>
    } @else {
      <div class="flight-section">
        <h3>Liste de tous les vols</h3>
        @for (flight of flightList; track flightList) {
          <div class="destination-item">
            <div class="destination-info">
              <p class="long-text">{{ flight.aeroportDepart.ville }}({{ flight.aeroportDepart.nom }})
                ‚û°Ô∏è {{ flight.aeroportArrivee.ville }}({{ flight.aeroportArrivee.nom }})</p>
              <p class="short-text">{{ flight.dateDepart | date:'HH:mm' }} üï∞Ô∏è {{ flight.dateArrive | date:'HH:mm' }}</p>
              <p class="tag">{{ flightSearchForm.controls.class.value == 'economy' ? 'Economie' : 'Business' }}</p>
              <p class="short-text">{{ flight.prix }}/personne</p>
              <button type="button" (click)="selectFlight(flight)">R√©server</button>
            </div>
          </div>
        }
      </div>
    }
  </div>

  <app-confirm-modal (confirm)="handleConfirmation($event)"></app-confirm-modal>

</div>
